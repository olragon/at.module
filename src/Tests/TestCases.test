<?php

use Drupal\at_base\Tests\DrupalAPI\DrupalCacheAPI;
use Drupal\at_base\Tests\DrupalAPI\DrupalModuleAPI;

$files = array_merge(
    glob(AT_ROOT . '/src/Tests/DrupalAPI/*.php'),
    glob(AT_ROOT . '/src/Tests/Fixtures/*.php'),
    glob(AT_ROOT . '/src/Tests/Traits/*.php')
);

foreach ($files as $file) {
    require_once $file;
}

class AtModuleTestCases  extends DrupalWebTestCase
{

    protected $profile = 'testing';

    use \Drupal\at\Tests\Traits\CacheTestCaseTrait,
        \Drupal\at\Tests\Traits\ContainerTestCaseTrait,
        \Drupal\at\Tests\Traits\JsonSchemaTestCaseTrait,
        \Drupal\at\Tests\Traits\KeyValueStorageTestCaseTrait,
        \Drupal\at\Tests\Traits\RoutingTestCaseTrait;

    public static function getInfo()
    {
        return array(
            'name'        => 'AT Test cases',
            'description' => '…',
            'group'       => 'AT'
        );
    }

    public function setUp()
    {
        parent::setUp('at');
        at()->setDrupalCacheAPI(new DrupalCacheAPI());
        at()->setModuleAPI(new DrupalModuleAPI());
    }

    public function testWrapper()
    {
        $rclass = new ReflectionObject($this);
        foreach ($rclass->getMethods() as $method) {
            if (0 === strpos($method->getName(), 'check')) {
                if ('AtModuleTestCases' === $method->class) {
                    $this->assertTrue(TRUE, '[Checking] ' . $method->getName() . '…', 'Debug');
                    $this->{$method->getName()}();
                }
            }
        }
    }
}
